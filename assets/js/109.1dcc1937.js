(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{471:function(s,a,t){"use strict";t.r(a);var n=t(15),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#mapping"}},[s._v("Mapping")]),a("ul",[a("li",[a("a",{attrs:{href:"#字段类型"}},[s._v("字段类型")])]),a("li",[a("a",{attrs:{href:"#映射"}},[s._v("映射")])])])]),a("li",[a("a",{attrs:{href:"#索引管理操作"}},[s._v("索引管理操作")])]),a("li",[a("a",{attrs:{href:"#数据迁移"}},[s._v("数据迁移")])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mapping"}},[s._v("#")]),s._v(" Mapping")]),s._v(" "),a("h3",{attrs:{id:"字段类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字段类型"}},[s._v("#")]),s._v(" 字段类型")]),s._v(" "),a("p",[s._v("官方文档：https://www.elastic.co/guide/en/elasticsearch/reference/7.17/mapping-types.html")]),s._v(" "),a("blockquote",[a("p",[s._v("核心数据类型")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("字符串")]),s._v(" "),a("p",[s._v("text ⽤于全⽂索引，搜索时会自动使用分词器进⾏分词再匹配\nkeyword 不分词，搜索时需要匹配完整的值")])]),s._v(" "),a("li",[a("p",[s._v("数值型")]),s._v(" "),a("p",[s._v("整型： byte，short，integer，long\n浮点型： float, half_float, scaled_float，double")])]),s._v(" "),a("li",[a("p",[s._v("日期类型：date")])]),s._v(" "),a("li",[a("p",[s._v("范围型")]),s._v(" "),a("p",[s._v("integer_range， long_range， float_range，double_range，date_range")]),s._v(" "),a("p",[s._v("gt是大于，lt是小于，e是equals等于。")]),s._v(" "),a("p",[s._v("age_limit的区间包含了此值的文档都算是匹配。")])]),s._v(" "),a("li",[a("p",[s._v("布尔")]),s._v(" "),a("p",[s._v("boolean")])]),s._v(" "),a("li",[a("p",[s._v("二进制")]),s._v(" "),a("p",[s._v("binary 会把值当做经过 base64 编码的字符串，默认不存储，且不可搜索")])])]),s._v(" "),a("blockquote",[a("p",[s._v("复杂数据类型")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("对象")]),s._v(" "),a("p",[s._v("object一个对象中可以嵌套对象。")])]),s._v(" "),a("li",[a("p",[s._v("数组")]),s._v(" "),a("p",[s._v("Array：嵌套类型")]),s._v(" "),a("p",[s._v("nested 用于json对象数组")])])]),s._v(" "),a("h3",{attrs:{id:"映射"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#映射"}},[s._v("#")]),s._v(" 映射")]),s._v(" "),a("p",[s._v("Mapping(映射)是用来定义一个文档（document），以及它所包含的属性（field）是如何存储和索引的。")]),s._v(" "),a("p",[s._v("看mapping信息:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("GET bank/_mapping\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"索引管理操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引管理操作"}},[s._v("#")]),s._v(" 索引管理操作")]),s._v(" "),a("ul",[a("li",[s._v("创建索引并指定映射")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("PUT /my_index\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mappings"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"properties"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"integer"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keyword"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定为keyword")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全文检索。保存时候分词，检索时候进行分词匹配")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("查看映射")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("GET /my_index\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("添加新的字段映射")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("PUT /my_index/_mapping\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"properties"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"employee-id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keyword"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 字段不能被检索。检索")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("该"),a("code",[s._v("index")]),s._v("选项控制字段值是否被索引。它接受"),a("code",[s._v("true")]),s._v(" or"),a("code",[s._v("false")]),s._v("并默认为"),a("code",[s._v("true")]),s._v(". 未编入索引的字段不可查询。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("修改映射")]),s._v(" "),a("p",[s._v("不能更新映射，对于已经存在的字段映射不能更新。")]),s._v(" "),a("p",[s._v("更新必须创建新的索引，进行数据迁移。")])])]),s._v(" "),a("h2",{attrs:{id:"数据迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据迁移"}},[s._v("#")]),s._v(" 数据迁移")]),s._v(" "),a("p",[s._v("官方文档：https://www.elastic.co/guide/en/elasticsearch/reference/7.16/docs-reindex.html")]),s._v(" "),a("p",[s._v("先创建new_twitter的正确映射。")]),s._v(" "),a("p",[s._v("然后使用如下方式进行数据迁移，把"),a("code",[s._v("twitter")]),s._v("迁移到"),a("code",[s._v("new_twitters")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("POST _reindex\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"twitter"')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dest"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new_twitters"')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);