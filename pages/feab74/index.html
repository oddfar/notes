<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis - 学习笔记-总览 | OddFar&#39;s Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/notes/img/favicon.ico">
    <meta name="description" content="我们在黑暗中并肩前行，走在各自的朝圣路上!">
    <meta name="keywords" content="oddfar,zhiyuan">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/notes/assets/css/0.styles.f3c5be15.css" as="style"><link rel="preload" href="/notes/assets/js/app.f5d81fd3.js" as="script"><link rel="preload" href="/notes/assets/js/4.55bd5ee9.js" as="script"><link rel="preload" href="/notes/assets/js/1.40ff521e.js" as="script"><link rel="preload" href="/notes/assets/js/3.d2a5efbd.js" as="script"><link rel="preload" href="/notes/assets/js/103.c598e2f1.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.557b319b.js"><link rel="prefetch" href="/notes/assets/js/100.c1c90991.js"><link rel="prefetch" href="/notes/assets/js/101.813f7b2e.js"><link rel="prefetch" href="/notes/assets/js/102.d3e1d9ca.js"><link rel="prefetch" href="/notes/assets/js/104.da6b8d25.js"><link rel="prefetch" href="/notes/assets/js/105.04ae844e.js"><link rel="prefetch" href="/notes/assets/js/106.122506a8.js"><link rel="prefetch" href="/notes/assets/js/107.8534ba31.js"><link rel="prefetch" href="/notes/assets/js/108.ad8ec0f4.js"><link rel="prefetch" href="/notes/assets/js/109.1dcc1937.js"><link rel="prefetch" href="/notes/assets/js/11.864926e1.js"><link rel="prefetch" href="/notes/assets/js/110.6058df08.js"><link rel="prefetch" href="/notes/assets/js/111.ff90d9a9.js"><link rel="prefetch" href="/notes/assets/js/112.67a4511c.js"><link rel="prefetch" href="/notes/assets/js/113.3f73e1bd.js"><link rel="prefetch" href="/notes/assets/js/114.a8f3bfa7.js"><link rel="prefetch" href="/notes/assets/js/115.921439be.js"><link rel="prefetch" href="/notes/assets/js/116.73ddac82.js"><link rel="prefetch" href="/notes/assets/js/117.9daeb33c.js"><link rel="prefetch" href="/notes/assets/js/118.cef0fa1f.js"><link rel="prefetch" href="/notes/assets/js/119.fabf6bf0.js"><link rel="prefetch" href="/notes/assets/js/12.c9665aab.js"><link rel="prefetch" href="/notes/assets/js/120.b0246e30.js"><link rel="prefetch" href="/notes/assets/js/121.5d52654f.js"><link rel="prefetch" href="/notes/assets/js/122.b20b16ea.js"><link rel="prefetch" href="/notes/assets/js/123.c6954c80.js"><link rel="prefetch" href="/notes/assets/js/124.952b796c.js"><link rel="prefetch" href="/notes/assets/js/125.67e9dd69.js"><link rel="prefetch" href="/notes/assets/js/126.cfc67310.js"><link rel="prefetch" href="/notes/assets/js/127.e041365d.js"><link rel="prefetch" href="/notes/assets/js/128.5b412815.js"><link rel="prefetch" href="/notes/assets/js/129.3a2eca61.js"><link rel="prefetch" href="/notes/assets/js/13.ffb05b43.js"><link rel="prefetch" href="/notes/assets/js/130.828cb06d.js"><link rel="prefetch" href="/notes/assets/js/131.a84cc9b3.js"><link rel="prefetch" href="/notes/assets/js/132.d82eea2c.js"><link rel="prefetch" href="/notes/assets/js/133.59b3b6f9.js"><link rel="prefetch" href="/notes/assets/js/134.b3454286.js"><link rel="prefetch" href="/notes/assets/js/135.d0e8f80d.js"><link rel="prefetch" href="/notes/assets/js/136.9a6ecb08.js"><link rel="prefetch" href="/notes/assets/js/137.3e782865.js"><link rel="prefetch" href="/notes/assets/js/138.051578ce.js"><link rel="prefetch" href="/notes/assets/js/139.893cf741.js"><link rel="prefetch" href="/notes/assets/js/14.a0ed8bba.js"><link rel="prefetch" href="/notes/assets/js/140.54af2462.js"><link rel="prefetch" href="/notes/assets/js/141.c253cac6.js"><link rel="prefetch" href="/notes/assets/js/142.11e5c334.js"><link rel="prefetch" href="/notes/assets/js/143.c04fe670.js"><link rel="prefetch" href="/notes/assets/js/144.68019ec7.js"><link rel="prefetch" href="/notes/assets/js/145.bace04a0.js"><link rel="prefetch" href="/notes/assets/js/146.5e3b7700.js"><link rel="prefetch" href="/notes/assets/js/147.e0cf3efb.js"><link rel="prefetch" href="/notes/assets/js/148.9e643e58.js"><link rel="prefetch" href="/notes/assets/js/149.56d3480f.js"><link rel="prefetch" href="/notes/assets/js/15.236bb627.js"><link rel="prefetch" href="/notes/assets/js/150.396f1c71.js"><link rel="prefetch" href="/notes/assets/js/151.3540053c.js"><link rel="prefetch" href="/notes/assets/js/152.706a9cc7.js"><link rel="prefetch" href="/notes/assets/js/153.e48a1071.js"><link rel="prefetch" href="/notes/assets/js/154.25f45aa6.js"><link rel="prefetch" href="/notes/assets/js/155.31a557f0.js"><link rel="prefetch" href="/notes/assets/js/156.0a3e017a.js"><link rel="prefetch" href="/notes/assets/js/157.f52ed9ce.js"><link rel="prefetch" href="/notes/assets/js/158.3ed953ce.js"><link rel="prefetch" href="/notes/assets/js/159.a39164f4.js"><link rel="prefetch" href="/notes/assets/js/16.7448e52f.js"><link rel="prefetch" href="/notes/assets/js/17.ca282e90.js"><link rel="prefetch" href="/notes/assets/js/18.a9536862.js"><link rel="prefetch" href="/notes/assets/js/19.bd880beb.js"><link rel="prefetch" href="/notes/assets/js/2.7de9c511.js"><link rel="prefetch" href="/notes/assets/js/20.45c81e5e.js"><link rel="prefetch" href="/notes/assets/js/21.0adec914.js"><link rel="prefetch" href="/notes/assets/js/22.05a7f1fe.js"><link rel="prefetch" href="/notes/assets/js/23.16baff2b.js"><link rel="prefetch" href="/notes/assets/js/24.7405d421.js"><link rel="prefetch" href="/notes/assets/js/25.5bccc3c7.js"><link rel="prefetch" href="/notes/assets/js/26.151ec9eb.js"><link rel="prefetch" href="/notes/assets/js/27.58648605.js"><link rel="prefetch" href="/notes/assets/js/28.3a4794cf.js"><link rel="prefetch" href="/notes/assets/js/29.c40f4abb.js"><link rel="prefetch" href="/notes/assets/js/30.2b9f1b2b.js"><link rel="prefetch" href="/notes/assets/js/31.049b8197.js"><link rel="prefetch" href="/notes/assets/js/32.5a86085e.js"><link rel="prefetch" href="/notes/assets/js/33.47a46ca7.js"><link rel="prefetch" href="/notes/assets/js/34.19d07a0f.js"><link rel="prefetch" href="/notes/assets/js/35.c1c7fa47.js"><link rel="prefetch" href="/notes/assets/js/36.61b37a24.js"><link rel="prefetch" href="/notes/assets/js/37.d5ec228a.js"><link rel="prefetch" href="/notes/assets/js/38.46a68289.js"><link rel="prefetch" href="/notes/assets/js/39.1a7bc068.js"><link rel="prefetch" href="/notes/assets/js/40.115578fb.js"><link rel="prefetch" href="/notes/assets/js/41.c9b25e8e.js"><link rel="prefetch" href="/notes/assets/js/42.dc4e0b0d.js"><link rel="prefetch" href="/notes/assets/js/43.5bd9d18f.js"><link rel="prefetch" href="/notes/assets/js/44.fc338ced.js"><link rel="prefetch" href="/notes/assets/js/45.c484eb67.js"><link rel="prefetch" href="/notes/assets/js/46.85be572a.js"><link rel="prefetch" href="/notes/assets/js/47.0906d5a1.js"><link rel="prefetch" href="/notes/assets/js/48.10c84c7a.js"><link rel="prefetch" href="/notes/assets/js/49.8cb07faf.js"><link rel="prefetch" href="/notes/assets/js/5.6c0b706d.js"><link rel="prefetch" href="/notes/assets/js/50.0ef12596.js"><link rel="prefetch" href="/notes/assets/js/51.27ef43ad.js"><link rel="prefetch" href="/notes/assets/js/52.a4bd9e25.js"><link rel="prefetch" href="/notes/assets/js/53.e2a8b224.js"><link rel="prefetch" href="/notes/assets/js/54.c291ac17.js"><link rel="prefetch" href="/notes/assets/js/55.2a837e3f.js"><link rel="prefetch" href="/notes/assets/js/56.971095f5.js"><link rel="prefetch" href="/notes/assets/js/57.22b20ca5.js"><link rel="prefetch" href="/notes/assets/js/58.9fac042d.js"><link rel="prefetch" href="/notes/assets/js/59.111e1275.js"><link rel="prefetch" href="/notes/assets/js/6.2981ea96.js"><link rel="prefetch" href="/notes/assets/js/60.c51b6449.js"><link rel="prefetch" href="/notes/assets/js/61.495b203f.js"><link rel="prefetch" href="/notes/assets/js/62.593ef1ed.js"><link rel="prefetch" href="/notes/assets/js/63.4c47993a.js"><link rel="prefetch" href="/notes/assets/js/64.1d6fce23.js"><link rel="prefetch" href="/notes/assets/js/65.c761bcfe.js"><link rel="prefetch" href="/notes/assets/js/66.9faff52a.js"><link rel="prefetch" href="/notes/assets/js/67.864c24bb.js"><link rel="prefetch" href="/notes/assets/js/68.9180d04f.js"><link rel="prefetch" href="/notes/assets/js/69.7d0ca116.js"><link rel="prefetch" href="/notes/assets/js/7.587f0293.js"><link rel="prefetch" href="/notes/assets/js/70.6dfd72df.js"><link rel="prefetch" href="/notes/assets/js/71.71c4b550.js"><link rel="prefetch" href="/notes/assets/js/72.13dd9cf4.js"><link rel="prefetch" href="/notes/assets/js/73.faef3318.js"><link rel="prefetch" href="/notes/assets/js/74.96466e69.js"><link rel="prefetch" href="/notes/assets/js/75.4c02fd89.js"><link rel="prefetch" href="/notes/assets/js/76.b5237a4a.js"><link rel="prefetch" href="/notes/assets/js/77.5984d23b.js"><link rel="prefetch" href="/notes/assets/js/78.8159793b.js"><link rel="prefetch" href="/notes/assets/js/79.d439efe7.js"><link rel="prefetch" href="/notes/assets/js/80.fd565d86.js"><link rel="prefetch" href="/notes/assets/js/81.5fc27270.js"><link rel="prefetch" href="/notes/assets/js/82.57e95b12.js"><link rel="prefetch" href="/notes/assets/js/83.093ecc1d.js"><link rel="prefetch" href="/notes/assets/js/84.401948f3.js"><link rel="prefetch" href="/notes/assets/js/85.43734563.js"><link rel="prefetch" href="/notes/assets/js/86.ef5782e0.js"><link rel="prefetch" href="/notes/assets/js/87.513bce3b.js"><link rel="prefetch" href="/notes/assets/js/88.4c4d1f90.js"><link rel="prefetch" href="/notes/assets/js/89.71465ed7.js"><link rel="prefetch" href="/notes/assets/js/90.add32a12.js"><link rel="prefetch" href="/notes/assets/js/91.d168e230.js"><link rel="prefetch" href="/notes/assets/js/92.4cfc79e1.js"><link rel="prefetch" href="/notes/assets/js/93.e6d62235.js"><link rel="prefetch" href="/notes/assets/js/94.6b58a698.js"><link rel="prefetch" href="/notes/assets/js/95.ff6ddc3c.js"><link rel="prefetch" href="/notes/assets/js/96.2c82e92f.js"><link rel="prefetch" href="/notes/assets/js/97.4950f751.js"><link rel="prefetch" href="/notes/assets/js/98.028ab902.js"><link rel="prefetch" href="/notes/assets/js/99.b526735d.js"><link rel="prefetch" href="/notes/assets/js/vendors~docsearch.e8eeddec.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.f3c5be15.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><img src="/notes/img/logo.png" alt="OddFar's Notes" class="logo"> <span class="site-name can-hide">OddFar's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/initial-java/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/notes/java/se/object/" class="nav-link">Java面向对象</a></li><li class="dropdown-subitem"><a href="/notes/java/se/commonly-used-class/" class="nav-link">Java常用类</a></li><li class="dropdown-subitem"><a href="/notes/java/se/collection/synopsis/" class="nav-link">Java集合框架</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/thread/1/" class="nav-link">JUC多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/spring/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notes/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/notes/jenkins/" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><a href="/notes/ai/" class="nav-link">AI</a></div><div class="nav-item"><a href="/notes/spider/" class="nav-link">爬虫</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://oddfar.github.io/campus-doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Campus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://oddfar.github.io/campus-doc/campus-example/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  校园信息墙
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/notes/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/notes/archives/" class="nav-link">归档</a></div> <a href="https://github.com/oddfar/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/notes/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java-Se</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/initial-java/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/notes/java/se/object/" class="nav-link">Java面向对象</a></li><li class="dropdown-subitem"><a href="/notes/java/se/commonly-used-class/" class="nav-link">Java常用类</a></li><li class="dropdown-subitem"><a href="/notes/java/se/collection/synopsis/" class="nav-link">Java集合框架</a></li></ul></li><li class="dropdown-item"><h4>Java-Se进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/java/se/thread/1/" class="nav-link">JUC多线程</a></li></ul></li><li class="dropdown-item"><h4>Java-ee</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/javaweb/" class="nav-link">JavaWeb</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mysql/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/notes/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/notes/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/mybatis/study-note/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/notes/mybatis-plus/study-note/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>Spring</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/spring/" class="nav-link">Spring</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notes/rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><!----> <span class="title" style="display:;">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/notes/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/notes/jenkins/" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><a href="/notes/ai/" class="nav-link">AI</a></div><div class="nav-item"><a href="/notes/spider/" class="nav-link">爬虫</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://oddfar.github.io/campus-doc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Campus
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://oddfar.github.io/campus-doc/campus-example/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  校园信息墙
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/notes/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/notes/archives/" class="nav-link">归档</a></div> <a href="https://github.com/oddfar/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/redis/" class="sidebar-link">Redis - 知识体系</a></li><li><a href="/notes/pages/28aa50/" class="sidebar-link">Redis - 概念和基础</a></li><li><a href="/notes/pages/6ea36e/" class="sidebar-link">Redis - 五大数据类型</a></li><li><a href="/notes/pages/5898ab/" class="sidebar-link">Redis - 三种特殊数据类型</a></li><li><a href="/notes/pages/41f31b/" class="sidebar-link">Redis - 事务</a></li><li><a href="/notes/pages/216cfe/" class="sidebar-link">Redis - Java</a></li><li><a href="/notes/pages/feab74/" aria-current="page" class="active sidebar-link">Redis - 学习笔记-总览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notes/pages/feab74/#redis-conf" class="sidebar-link">Redis.conf</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#熟悉基本配置" class="sidebar-link">熟悉基本配置</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notes/pages/feab74/#redis的持久化" class="sidebar-link">Redis的持久化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#rdb-redis-database" class="sidebar-link">RDB（Redis DataBase）</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#aof-append-only-file" class="sidebar-link">AOF（Append Only File）</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notes/pages/feab74/#redis-发布订阅" class="sidebar-link">Redis 发布订阅</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#测试" class="sidebar-link">测试</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#原理" class="sidebar-link">原理</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notes/pages/feab74/#redis主从复制" class="sidebar-link">Redis主从复制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#环境配置" class="sidebar-link">环境配置</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#一主二从" class="sidebar-link">一主二从</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#哨兵模式" class="sidebar-link">哨兵模式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notes/pages/feab74/#缓存穿透与雪崩" class="sidebar-link">缓存穿透与雪崩</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#缓存穿透-查不到" class="sidebar-link">缓存穿透（查不到）</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#缓存击穿-量太大-缓存过期" class="sidebar-link">缓存击穿（量太大，缓存过期）</a></li><li class="sidebar-sub-header level3"><a href="/notes/pages/feab74/#缓存雪崩" class="sidebar-link">缓存雪崩</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ElasticSearch</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/notes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>数据库</span></li><li data-v-06225672><span data-v-06225672>Redis</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://oddfar.com/" target="_blank" title="作者" class="beLink" data-v-06225672>zhiyuan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-05-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Redis - 学习笔记-总览<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="redis-conf"><a href="#redis-conf" class="header-anchor">#</a> Redis.conf</h2> <h3 id="熟悉基本配置"><a href="#熟悉基本配置" class="header-anchor">#</a> 熟悉基本配置</h3> <blockquote><p>位置</p></blockquote> <p>Redis 的配置文件位于 Redis 安装目录下，文件名为 redis.conf</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>config get * <span class="token comment"># 获取全部的配置</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们一般情况下，会单独拷贝出来一份进行操作。来保证初始文件的安全。</p> <p>正如在 <code>安装redis</code> 中的讲解中拷贝一份</p> <blockquote><p>容量单位不区分大小写，G和GB有区别</p></blockquote> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210408213939472.png" alt="image-20210408213939472"></p> <blockquote><p>include 组合多个配置</p></blockquote> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210408214037264.png" alt="image-20210408214037264"></p> <p>和Spring配置文件类似，可以通过includes包含，redis.conf 可以作为总文件，可以包含其他文件！</p> <blockquote><p>NETWORK 网络配置</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 <span class="token comment"># 绑定的ip</span>
protected-mode <span class="token function">yes</span> <span class="token comment"># 保护模式</span>
port <span class="token number">6379</span> <span class="token comment"># 默认端口</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>GENERAL 通用</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>daemonize <span class="token function">yes</span> <span class="token comment"># 默认情况下，Redis不作为守护进程运行。需要开启的话，改为 yes</span>

supervised no <span class="token comment"># 可通过upstart和systemd管理Redis守护进程</span>

loglevel notice <span class="token comment"># 日志级别。可选项有：</span>
				<span class="token comment"># debug（记录大量日志信息，适用于开发、测试阶段）</span>
				<span class="token comment"># verbose（较多日志信息）</span>
				<span class="token comment"># notice（适量日志信息，使用于生产环境）</span>
				<span class="token comment"># warning（仅有部分重要、关键信息才会被记录）</span>
logfile <span class="token string">&quot;&quot;</span> <span class="token comment"># 日志文件的位置，当指定为空字符串时，为标准输出</span>
databases <span class="token number">16</span> <span class="token comment"># 设置数据库的数目。默认的数据库是DB 0</span>
always-show-logo <span class="token function">yes</span> <span class="token comment"># 是否总是显示logo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>SNAPSHOPTING 快照，持久化规则</p></blockquote> <p>由于Redis是基于内存的数据库，需要将数据由内存持久化到文件中</p> <p>持久化方式：</p> <ul><li>RDB</li> <li>AOF</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 900秒（15分钟）内至少1个key值改变（则进行数据库保存--持久化）</span>
save <span class="token number">900</span> <span class="token number">1</span>
<span class="token comment"># 300秒（5分钟）内至少10个key值改变（则进行数据库保存--持久化）</span>
save <span class="token number">300</span> <span class="token number">10</span>
<span class="token comment"># 60秒（1分钟）内至少10000个key值改变（则进行数据库保存--持久化）</span>
save <span class="token number">60</span> <span class="token number">10000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>RDB文件相关</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>stop-writes-on-bgsave-error <span class="token function">yes</span> <span class="token comment"># 持久化出现错误后，是否依然进行继续进行工作</span>

rdbcompression <span class="token function">yes</span> <span class="token comment"># 使用压缩rdb文件 yes：压缩，但是需要一些cpu的消耗。no：不压缩，需要更多的磁盘空间</span>

rdbchecksum <span class="token function">yes</span> <span class="token comment"># 是否校验rdb文件，更有利于文件的容错性，但是在保存rdb文件的时候，会有大概10%的性能损耗</span>

dbfilename dump.rdb <span class="token comment"># dbfilenamerdb文件名称</span>

<span class="token function">dir</span> ./ <span class="token comment"># dir 数据目录，数据库的写入会在这个目录。rdb、aof文件也会写在这个目录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>REPLICATION主从复制</p></blockquote> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210408214742862.png" alt="image-20210408214742862"></p> <p>后面详细说</p> <blockquote><p>SECURITY安全</p></blockquote> <p>访问密码的查看，设置和取消</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动redis</span>
<span class="token comment"># 连接客户端</span>

<span class="token comment"># 获得和设置密码</span>
config get requirepass
config <span class="token builtin class-name">set</span> requirepass <span class="token string">&quot;123456&quot;</span>

<span class="token comment">#测试ping，发现需要验证</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
NOAUTH Authentication required.
<span class="token comment"># 验证</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> auth <span class="token number">123456</span>
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>客户端连接相关</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>maxclients <span class="token number">10000</span>  最大客户端数量
maxmemory <span class="token operator">&lt;</span>bytes<span class="token operator">&gt;</span> 最大内存限制
maxmemory-policy noeviction <span class="token comment"># 内存达到限制值的处理策略</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>maxmemory-policy 六种方式</strong></p> <p>**1、volatile-lru：**利用LRU算法移除设置过过期时间的key。</p> <p><strong>2、allkeys-lru ：</strong> 用lru算法删除lkey</p> <p>**3、volatile-random：**随机删除即将过期key</p> <p>**4、allkeys-random：**随机删除</p> <p><strong>5、volatile-ttl ：</strong> 删除即将过期的</p> <p><strong>6、noeviction ：</strong> 不移除任何key，只是返回一个写错误。</p> <p>redis 中的<strong>默认</strong>的过期策略是 <strong>volatile-lru</strong> 。</p> <p><strong>设置方式</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>config <span class="token builtin class-name">set</span> maxmemory-policy volatile-lru 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>append only模式</p></blockquote> <p>（AOF相关部分）</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215037918.png" alt="在这里插入图片描述"></p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215047999.png" alt="在这里插入图片描述"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>appendfsync everysec <span class="token comment"># appendfsync aof持久化策略的配置</span>
        <span class="token comment"># no表示不执行fsync，由操作系统保证数据同步到磁盘，速度最快。</span>
        <span class="token comment"># always表示每次写入都执行fsync，以保证数据同步到磁盘。</span>
        <span class="token comment"># everysec表示每秒执行一次fsync，可能会导致丢失这1s数据。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="redis的持久化"><a href="#redis的持久化" class="header-anchor">#</a> Redis的持久化</h2> <p>Redis 是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失。所以 Redis 提供了持久化功能！</p> <p><strong>Rdb 保存的是 dump.rdb 文件</strong></p> <h3 id="rdb-redis-database"><a href="#rdb-redis-database" class="header-anchor">#</a> RDB（Redis DataBase）</h3> <blockquote><p>什么是RDB</p></blockquote> <p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照，它恢复时是将快 照文件直接读到内存里。</p> <p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。 这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。</p> <blockquote><p>Fork</p></blockquote> <p>Fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量，环境变量，程序计数器等） 数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程。</p> <p><strong>配置位置及SNAPSHOTTING解析</strong></p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210408224901985.png" alt="image-20210408224901985"></p> <p>这里的触发条件机制，我们可以修改测试一下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>save <span class="token number">120</span> <span class="token number">10</span> <span class="token comment"># 120秒内修改10次则触发RDB</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>RDB 是整合内存的压缩过的Snapshot，RDB 的数据结构，可以配置复合的快照触发条件。</p> <p>如果想禁用RDB持久化的策略，只要不设置任何save指令，或者给save传入一个空字符串参数也可以。</p> <p>若要修改完毕需要立马生效，可以手动使用 save 命令！立马生效 !</p> <p>save不是创建一个新进程去进行持久化</p> <blockquote><p>其余命令解析</p></blockquote> <p>Stop-writes-on-bgsave-error：如果配置为no，表示你不在乎数据不一致或者有其他的手段发现和控制，默认为yes。</p> <p>rbdcompression：对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用 LZF算法进行压缩，如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能。</p> <p>rdbchecksum：在存储快照后，还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约 10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能。默认为yes。</p> <blockquote><p>如何触发RDB快照</p></blockquote> <p>1、配置文件中默认的快照配置，建议多用一台机子作为备份，复制一份 dump.rdb</p> <p>2、命令save或者是bgsave</p> <ul><li><p>save 时只管保存，其他不管，全部阻塞</p></li> <li><p>bgsave，Redis 会在后台异步进行快照操作，快照同时还可以响应客户端请求。可以通过lastsave
命令获取最后一次成功执行快照的时间。</p></li></ul> <p>3、执行flushall命令，也会产生 dump.rdb 文件，但里面是空的，无意义 !</p> <p>4、退出的时候也会产生 dump.rdb 文件！</p> <blockquote><p>如何恢复</p></blockquote> <p>1、将备份文件（dump.rdb）移动到redis安装目录并启动服务即可</p> <p>2、CONFIG GET dir 获取目录</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get <span class="token function">dir</span>
<span class="token function">dir</span>
/usr/local/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>优点和缺点</p></blockquote> <p><strong>优点：</strong></p> <p>1、适合大规模的数据恢复</p> <p>2、对数据完整性和一致性要求不高</p> <p><strong>缺点：</strong></p> <p>1、在一定间隔时间做一次备份，所以如果redis意外down掉的话，就会丢失最后一次快照后的所有修改</p> <p>2、Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑。</p> <blockquote><p>小结</p></blockquote> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210408225404338.png" alt="image-20210408225404338"></p> <h3 id="aof-append-only-file"><a href="#aof-append-only-file" class="header-anchor">#</a> AOF（Append Only File）</h3> <blockquote><p>简介</p></blockquote> <p>以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件 的内容将写指令从前到后执行一次以完成数据的恢复工作</p> <p><strong>Aof保存的是 appendonly.aof 文件</strong></p> <blockquote><p>配置</p></blockquote> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210408225620719.png" alt="image-20210408225620719"></p> <ul><li><p>appendonly no</p> <p>是否以append only模式作为持久化方式，默认使用的是rdb方式持久化，这 种方式在许多应用中已经足够用了</p></li> <li><p>appendfilename &quot;appendonly.aof&quot;</p> <p>appendfilename AOF 文件名称</p></li> <li><p>appendfsync everysec</p> <p>appendfsync aof持久化策略的配置</p> <blockquote><p>no表示不执行fsync，由操作系统保证数据同步到磁盘，速度最快。
always表示每次写入都执行fsync，以保证数据同步到磁盘。
everysec表示每秒执行一次fsync，可能会导致丢失这1s数据。</p></blockquote></li> <li><p>No-appendfsync-on-rewrite</p> <p>重写时是否可以运用Appendfsync，用默认no即可，保证数据安全性</p></li> <li><p>Auto-aof-rewrite-min-size</p> <p>设置重写的基准值</p></li> <li><p>Auto-aof-rewrite-percentage</p> <p>设置重写的基准值</p></li></ul> <blockquote><p>AOF 启动/修复/恢复</p></blockquote> <p><strong>正常恢复：</strong></p> <p>启动：设置Yes，修改默认的appendonly no，改为yes
将有数据的aof文件复制一份保存到对应目录（config get dir）
恢复：重启redis然后重新加载</p> <p><strong>异常恢复：</strong></p> <p>启动：设置Yes
故意破坏 appendonly.aof 文件！
修复：命令<code>redis-check-aof --fix appendonly.aof</code> 进行修复
恢复：重启 redis 然后重新加载</p> <blockquote><p>Rewrite重写</p></blockquote> <p>AOF 采用文件追加方式，文件会越来越大，为避免出现此种情况，新增了重写机制，当AOF文件的大小超过所设定的阈值时，Redis 就会启动AOF 文件的内容压缩，只保留可以恢复数据的最小指令集，可以 使用命令 bgrewriteaof ！</p> <p><strong>重写原理：</strong></p> <p>AOF 文件持续增长而过大时，会fork出一条新进程来将文件重写（也是先写临时文件最后再 rename），遍历新进程的内存中数据，每条记录有一条的Set语句。重写aof文件的操作，并没有读取旧 的aof文件，这点和快照有点类似！</p> <p><strong>触发机制：</strong></p> <p>Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的已被且文件大 于64M的触发。</p> <blockquote><p>优点和缺点</p></blockquote> <p><strong>优点：</strong></p> <p>1、每修改同步：appendfsync always 同步持久化，每次发生数据变更会被立即记录到磁盘，性能较差但数据完整性比较好</p> <p>2、每秒同步： appendfsync everysec 异步操作，每秒记录 ，如果一秒内宕机，有数据丢失</p> <p>3、不同步： appendfsync no 从不同步</p> <p><strong>缺点：</strong></p> <p>1、相同数据集的数据而言，aof 文件要远大于 rdb文件，恢复速度慢于 rdb。</p> <p>2、Aof 运行效率要慢于 rdb，每秒同步策略效率较好，不同步效率和rdb相同。</p> <blockquote><p>小结</p></blockquote> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210408230339879.png" alt="image-20210408230339879"></p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>1、RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</p> <p>2、AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以Redis 协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的体积不至于过大。</p> <p>3、只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化</p> <p>4、同时开启两种持久化方式</p> <ul><li>在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF 文件保存的数据集要比RDB文件保存的数据集要完整。</li> <li>RDB 的数据不实时，同时使用两者时服务器重启也只会找AOF文件，那要不要只使用AOF呢？建议不要，因为RDB更适合用于备份数据库（AOF在不断变化不好备份），快速重启，而且不会有 AOF可能潜在的Bug，留着作为一个万一的手段。</li></ul> <p>5、性能建议</p> <ul><li>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够 了，只保留 save 900 1 这条规则。</li> <li>如果Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自 己的AOF文件就可以了，代价一是带来了持续的IO，二是AOF rewrite 的最后将 rewrite 过程中产 生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite 的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上，默认超过原大小100%大小重 写可以改到适当的数值。</li> <li>如果不Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔IO，也 减少了rewrite时带来的系统波动。代价是如果Master/Slave 同时倒掉，会丢失十几分钟的数据， 启动脚本也要比较两个 Master/Slave 中的 RDB文件，载入较新的那个，微博就是这种架构。</li></ul> <h2 id="redis-发布订阅"><a href="#redis-发布订阅" class="header-anchor">#</a> Redis 发布订阅</h2> <h3 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h3> <p>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。</p> <p>Redis 客户端可以订阅任意数量的频道。</p> <p>订阅/发布消息图：</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409105838259.png" alt="image-20210409105838259"></p> <p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409105859670.png" alt="image-20210409105859670"></p> <p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409110314032.png" alt="image-20210409110314032"></p> <p><strong>命令</strong></p> <p>下表列出了 redis 发布订阅常用命令：</p> <table><thead><tr><th style="text-align:left;">序号</th> <th style="text-align:left;">命令及描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">[PSUBSCRIBE pattern [pattern ...]]<br>订阅一个或多个符合给定模式的频道。</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">[PUBSUB subcommand [argument [argument ...]]]<br>查看订阅与发布系统状态。</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">[PUBLISH channel message] <br>将信息发送到指定的频道。</td></tr> <tr><td style="text-align:left;">4</td> <td style="text-align:left;">[PUNSUBSCRIBE [pattern [pattern ...]]] <br>退订所有给定模式的频道。</td></tr> <tr><td style="text-align:left;">5</td> <td style="text-align:left;">[SUBSCRIBE channel [channel ...]]<br>订阅给定的一个或多个频道的信息。</td></tr> <tr><td style="text-align:left;">6</td> <td style="text-align:left;">[UNSUBSCRIBE [channel [channel ...]]]<br>指退订给定的频道。</td></tr></tbody></table> <h3 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h3> <p>以下实例演示了发布订阅是如何工作的。</p> <p>我们先打开两个 redis-cli 客户端</p> <p>在<strong>第一个 redis-cli 客户端</strong>，创建订阅频道名为 redisChat，输入SUBSCRIBE redisChat</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SUBSCRIBE redisChat
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;redisChat&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在<strong>第二个客户端</strong>，发布两次消息，订阅者就能接收 到消息。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PUBLISH redisChat <span class="token string">&quot;Hello,Redis&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
redis <span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PUBLISH redisChat <span class="token string">&quot;Hello，java&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>订阅者的客户端会显示如下消息</p> <blockquote><ol><li>&quot;message&quot;</li> <li>&quot;redisChat&quot;</li> <li>&quot;Hello,Redis&quot;</li> <li>&quot;message&quot;</li> <li>&quot;redisChat&quot;</li> <li>&quot;Hello，java&quot;</li></ol></blockquote> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>Redis是使用C实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，来加深对 Redis 的理解。</p> <p>Redis 通过 PUBLISH 、SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。</p> <p>通过 SUBSCRIBE 命令订阅某频道后，redis-server 里维护了一个字典，字典的键就是一个个 channel ，而字典的值则是一个链表，链表中保存了所有订阅这个 channel 的客户端。SUBSCRIBE 命令的关键，就是将客户端添加到给定 channel 的订阅链表中。</p> <p>通过 PUBLISH 命令向订阅者发送消息，redis-server 会使用给定的频道作为键，在它所维护的 channel 字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者。</p> <p>Pub/Sub 从字面上理解就是发布（Publish）与订阅（Subscribe），在Redis中，你可以设定对某一个 key值进行消息发布及消息订阅，当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p> <p>使用场景：</p> <p>Redis的Pub/Sub系统可以构建实时的消息系统，比如很多用Pub/Sub构建的实时聊天系统的例子。</p> <h2 id="redis主从复制"><a href="#redis主从复制" class="header-anchor">#</a> Redis主从复制</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点 (master/leader)，后者称为从节点(slave/follower)；数据的复制是单向的，只能由主节点到从节点。 Master以写为主，Slave 以读为主。</p> <p>默认情况下，每台Redis服务器都是主节点；且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点。</p> <p>主从复制的作用主要包括：</p> <p>1、数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</p> <p>2、故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</p> <p>3、负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务 （即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</p> <p>4、高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redis高可用的基础。</p> <p>一般来说，要将Redis运用于工程项目中，只使用一台Redis是万万不能的，原因如下：</p> <p>1、从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较 大；</p> <p>2、从容量上，单个Redis服务器内存容量有限，就算一台Redis服务器内存容量为256G，也不能将所有内存用作Redis存储内存，一般来说，单台Redis最大使用内存不应该超过20G。</p> <p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是&quot;多读少写&quot;。</p> <p>对于这种场景，我们可以使如下这种架构：</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409112108209.png" alt="image-20210409112108209"></p> <h3 id="环境配置"><a href="#环境配置" class="header-anchor">#</a> 环境配置</h3> <blockquote><p>基本配置</p></blockquote> <p>查看当前库的信息：<code>info replication</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
<span class="token comment"># Replication</span>
role:master	<span class="token comment"># 角色</span>
connected_slaves:0	<span class="token comment"># 从机数量</span>
master_failover_state:no-failover
master_replid:1a6933acf7ec9711bfa0a1848976676557e1e6a0
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>因为没有多个服务器，就以本地开启3个端口，模拟3个服务</p> <p>既然需要启动多个服务，就需要多个配置文件。每个配置文件对应修改以下信息：</p> <ul><li>端口号（port）</li> <li>pid文件名（pidfile）</li> <li>日志文件名（logfile）</li> <li>rdb文件名（dbfilename）</li></ul> <p>1、拷贝多个redis.conf 文件</p> <p>端口分别是6379、6380、6381</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/bin/myconfig</span>
<span class="token punctuation">[</span>root@localhost myconfig<span class="token punctuation">]</span><span class="token comment"># ls</span>
dump.rdb  redis.conf
<span class="token punctuation">[</span>root@localhost myconfig<span class="token punctuation">]</span><span class="token comment"># cp redis.conf redis79.conf</span>
<span class="token punctuation">[</span>root@localhost myconfig<span class="token punctuation">]</span><span class="token comment"># cp redis.conf redis80.conf</span>
<span class="token punctuation">[</span>root@localhost myconfig<span class="token punctuation">]</span><span class="token comment"># cp redis.conf redis81.conf</span>
<span class="token punctuation">[</span>root@localhost myconfig<span class="token punctuation">]</span><span class="token comment"># ls</span>
dump.rdb  redis79.conf  redis80.conf  redis81.conf  redis.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>分别修改配置上面四点对应的配置，举例：</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409115138265.png" alt="image-20210409115138265"></p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409115114373.png" alt="image-20210409115114373"></p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409115241761.png" alt="image-20210409115241761"></p> <p>配置好分别启动3个不同端口服务</p> <ul><li><p>redis-server myconfig/redis79.conf</p></li> <li><p>redis-server myconfig/redis80.conf</p></li> <li><p>redis-server myconfig/redis81.conf</p></li></ul> <p>redis-server myconfig/redis79.conf</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215610163.png" alt="在这里插入图片描述"></p> <h3 id="一主二从"><a href="#一主二从" class="header-anchor">#</a> 一主二从</h3> <p>1、之后我们再分别开启redis连接，redis-cli -p 6379，redis-cli -p 6380，redis-cli -p 6381</p> <p>通过指令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以发现，默认情况下，开启的每个redis服务器都是主节点</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409134833129.png" alt="image-20210409134833129"></p> <p>2、配置为一个Master 两个Slave（即一主二从）</p> <p>6379为主，6380,6381为从</p> <p>slaveof 127.0.0.1 6379</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409134929416.png" alt="image-20210409134929416"></p> <p>3、在主机设置值，在从机都可以取到！从机不能写值！</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409135325865.png" alt="image-20210409135325865"></p> <p>我们这里是使用命令搭建，是“暂时的”，也可去配置里进行修改，这样话则是“永久的”</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409135633320.png" alt="image-20210409135633320"></p> <blockquote><p>使用规则</p></blockquote> <p>当主机断电宕机后，默认情况下从机的角色不会发生变化 ，集群中只是失去了写操作，当主机恢复以后，又会连接上从机恢复原状。</p> <p>当从机断电宕机后，若不是使用配置文件配置的从机，再次启动后作为主机是无法获取之前主机的数据的，若此时重新配置称为从机，又可以获取到主机的所有数据。这里就要提到一个同步原理。</p> <p>有两种方式可以产生新的主机：看下文“谋权篡位”</p> <blockquote><p>层层链路</p></blockquote> <p>上一个Slave 可以是下一个slave 和 Master，Slave 同样可以接收其他 slaves 的连接和同步请求，那么 该 slave 作为了链条中下一个的master，可以有效减轻 master 的写压力！</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409135939928.png" alt="image-20210409135939928"></p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409135955890.png" alt="image-20210409135955890"></p> <blockquote><p>谋权篡位</p></blockquote> <p>有两种方式可以产生新的主机：</p> <ul><li>从机手动执行命令<code>slaveof no one</code>,这样执行以后从机会独立出来成为一个主机</li> <li>使用哨兵模式（自动选举）</li></ul> <blockquote><p>复制原理</p></blockquote> <p>Slave 启动成功连接到 master 后会发送一个sync命令</p> <p>Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行 完毕之后，master将传送整个数据文件到slave，并完成一次完全同步。</p> <p>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p> <p>增量复制：Master 继续将新的所有收集到的修改命令依次传给slave，完成同步</p> <p>但是只要是重新连接master，一次完全同步（全量复制）将被自动执行</p> <h3 id="哨兵模式"><a href="#哨兵模式" class="header-anchor">#</a> 哨兵模式</h3> <p>更多信息参考博客：https://www.jianshu.com/p/06ab9daf921d</p> <blockquote><p>概述</p></blockquote> <p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工 干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑 哨兵模式。Redis从2.8开始正式提供了Sentinel（哨兵） 架构来解决这个问题。</p> <p>谋朝篡位的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。</p> <p>哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独 立运行。其原理是<strong>哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。</strong></p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409150628118.png" alt="image-20210409150628118"></p> <p>这里的哨兵有两个作用</p> <ul><li>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。</li> <li>当哨兵监测到master宕机，会自动将slave切换成master，然后通过<strong>发布订阅模式</strong>通知其他的从服务器，修改配置文件，让它们切换主机。</li></ul> <p>然而一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。 各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/image-20210409150717930.png" alt="image-20210409150717930"></p> <p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认 为主服务器不可用，这个现象成为<strong>主观下线</strong>。当后面的哨兵也检测到主服务器不可用，并且数量达到一 定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。 切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为 <strong>客观下线</strong>。</p> <blockquote><p>配置测试</p></blockquote> <p>1、调整结构，6379带着80、81</p> <p>2、自定义的 /myconfig 目录下新建 sentinel.conf 文件，名字千万不要错</p> <p>3、配置哨兵，填写内容</p> <ul><li><p><code>sentinel monitor 被监控主机名字 127.0.0.1 6379 1</code></p> <p>例如：sentinel monitor mymaster 127.0.0.1 6379 1，</p> <p>上面最后一个数字1，表示主机挂掉后slave投票看让谁接替成为主机，得票数多少后成为主机</p></li></ul> <p>4、启动哨兵</p> <ul><li><p>Redis-sentinel myconfig/sentinel.conf</p> <p>上述目录依照各自的实际情况配置，可能目录不同</p></li></ul> <p>成功启动哨兵模式</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215752444.png" alt="在这里插入图片描述"></p> <p>此时哨兵监视着我们的主机6379，当我们断开主机后：</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215806972.png" alt="在这里插入图片描述"></p> <blockquote><p>哨兵模式的优缺点</p></blockquote> <p><strong>优点</strong></p> <ol><li>哨兵集群，基于主从复制模式，所有主从复制的优点，它都有</li> <li>主从可以切换，故障可以转移，系统的可用性更好</li> <li>哨兵模式是主从模式的升级，手动到自动，更加健壮</li></ol> <p><strong>缺点：</strong></p> <ol><li>Redis不好在线扩容，集群容量一旦达到上限，在线扩容就十分麻烦</li> <li>实现哨兵模式的配置其实是很麻烦的，里面有很多配置项</li></ol> <blockquote><p>哨兵模式的全部配置</p></blockquote> <p>完整的哨兵模式配置文件 sentinel.conf</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Example sentinel.conf</span>
 
<span class="token comment"># 哨兵sentinel实例运行的端口 默认26379</span>
port <span class="token number">26379</span>
 
<span class="token comment"># 哨兵sentinel的工作目录</span>
<span class="token function">dir</span> /tmp
 
<span class="token comment"># 哨兵sentinel监控的redis主节点的 ip port </span>
<span class="token comment"># master-name  可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符&quot;.-_&quot;组成。</span>
<span class="token comment"># quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了</span>
<span class="token comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span>
 
<span class="token comment"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span>
<span class="token comment"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span>
<span class="token comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span>
sentinel auth-pass mymaster MySUPER--secret-0123passw0rd
 
 
<span class="token comment"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span>
<span class="token comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span>
sentinel down-after-milliseconds mymaster <span class="token number">30000</span>
 
<span class="token comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span>
这个数字越小，完成failover所需的时间就越长，
但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。
可以通过将这个值设为 <span class="token number">1</span> 来保证每次只有一个slave 处于不能处理命令请求的状态。
<span class="token comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span>
sentinel parallel-syncs mymaster <span class="token number">1</span>
 
 
 
<span class="token comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面： </span>
<span class="token comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span>
<span class="token comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span>
<span class="token comment">#3.当想要取消一个正在进行的failover所需要的时间。  </span>
<span class="token comment">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span>
<span class="token comment"># 默认三分钟</span>
<span class="token comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span>
sentinel failover-timeout mymaster <span class="token number">180000</span>
 
<span class="token comment"># SCRIPTS EXECUTION</span>
 
<span class="token comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span>
<span class="token comment">#对于脚本的运行结果有以下规则：</span>
<span class="token comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span>
<span class="token comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span>
<span class="token comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span>
<span class="token comment">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span>
 
<span class="token comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，</span>
<span class="token comment">#这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，</span>
<span class="token comment">#一个是事件的类型，</span>
<span class="token comment">#一个是事件的描述。</span>
<span class="token comment">#如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span>
<span class="token comment">#通知脚本</span>
<span class="token comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span>
  sentinel notification-script mymaster /var/redis/notify.sh
 
<span class="token comment"># 客户端重新配置主节点参数脚本</span>
<span class="token comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span>
<span class="token comment"># 以下参数将会在调用脚本时传给脚本:</span>
<span class="token comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span>
<span class="token comment"># 目前&lt;state&gt;总是“failover”,</span>
<span class="token comment"># &lt;role&gt;是“leader”或者“observer”中的一个。 </span>
<span class="token comment"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span>
<span class="token comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span>
<span class="token comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span>
sentinel client-reconfig-script mymaster /var/redis/reconfig.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h2 id="缓存穿透与雪崩"><a href="#缓存穿透与雪崩" class="header-anchor">#</a> 缓存穿透与雪崩</h2> <h3 id="缓存穿透-查不到"><a href="#缓存穿透-查不到" class="header-anchor">#</a> 缓存穿透（查不到）</h3> <blockquote><p>概念</p></blockquote> <p>在默认情况下，用户请求数据时，会先在缓存(Redis)中查找，若没找到即缓存未命中，再在数据库中进行查找，数量少可能问题不大，可是一旦大量的请求数据（例如秒杀场景）缓存都没有命中的话，就会全部转移到数据库上，造成数据库极大的压力，就有可能导致数据库崩溃。网络安全中也有人恶意使用这种手段进行攻击被称为洪水攻击。</p> <blockquote><p>解决方案</p></blockquote> <p><strong>布隆过滤器</strong></p> <p>对所有可能查询的参数以Hash的形式存储，以便快速确定是否存在这个值，在控制层先进行拦截校验，校验不通过直接打回，减轻了存储系统的压力。</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215824722.jpg" alt="在这里插入图片描述"></p> <p><strong>缓存空对象</strong></p> <p>一次请求若在缓存和数据库中都没找到，就在缓存中方一个空对象用于处理后续这个请求。</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215836317.jpg" alt="在这里插入图片描述"></p> <p>这样做有一个缺陷：存储空对象也需要空间，大量的空对象会耗费一定的空间，存储效率并不高。解决这个缺陷的方式就是设置较短过期时间</p> <p>即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p> <h3 id="缓存击穿-量太大-缓存过期"><a href="#缓存击穿-量太大-缓存过期" class="header-anchor">#</a> 缓存击穿（量太大，缓存过期）</h3> <blockquote><p>概念</p></blockquote> <p>相较于缓存穿透，缓存击穿的目的性更强，一个存在的key，在缓存过期的一刻，同时有大量的请求，这些请求都会击穿到DB，造成瞬时DB请求量大、压力骤增。这就是缓存被击穿，只是针对其中某个key的缓存不可用而导致击穿，但是其他的key依然可以使用缓存响应。</p> <p>比如热搜排行上，一个热点新闻被同时大量访问就可能导致缓存击穿。</p> <blockquote><p>解决方案</p></blockquote> <ol><li><p><strong>设置热点数据永不过期</strong></p> <p>这样就不会出现热点数据过期的情况，但是当Redis内存空间满的时候也会清理部分数据，而且此种方案会占用空间，一旦热点数据多了起来，就会占用部分空间。</p></li> <li><p><strong>加互斥锁(分布式锁)</strong></p> <p>在访问key之前，采用SETNX（set if not exists）来设置另一个短期key来锁住当前key的访问，访问结束再删除该短期key。保证同时刻只有一个线程访问。这样对锁的要求就十分高。</p></li></ol> <h3 id="缓存雪崩"><a href="#缓存雪崩" class="header-anchor">#</a> 缓存雪崩</h3> <blockquote><p>概念</p></blockquote> <p>大量的key设置了相同的过期时间，导致在缓存在同一时刻全部失效，造成瞬时DB请求量大、压力骤增，引起雪崩。</p> <p>产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p> <p><img src="https://testingcf.jsdelivr.net/gh/oddfar/static/img/Redis.assets/20200513215850428.jpeg" alt="在这里插入图片描述"></p> <p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然 形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就 是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知 的，很有可能瞬间就把数据库压垮。</p> <blockquote><p>解决方案</p></blockquote> <ul><li><p>redis高可用</p> <p>这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群</p></li> <li><p>限流降级</p> <p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p></li> <li><p>数据预热</p> <p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p></li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/oddfar/notes/edit/master/docs/03.数据库/10.Redis/10.Redis学习笔记-总览.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2023/03/26, 13:03:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notes/pages/216cfe/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Redis - Java</div></a> <a href="/notes/es/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">ElasticSearch - 知识体系</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notes/pages/216cfe/" class="prev">Redis - Java</a></span> <span class="next"><a href="/notes/es/">ElasticSearch - 知识体系</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:oddfar@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/oddfar" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2025
    <span>oddfar | <a href="https://beian.miit.gov.cn/" target="_blank">冀ICP备20001094号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.f5d81fd3.js" defer></script><script src="/notes/assets/js/4.55bd5ee9.js" defer></script><script src="/notes/assets/js/1.40ff521e.js" defer></script><script src="/notes/assets/js/3.d2a5efbd.js" defer></script><script src="/notes/assets/js/103.c598e2f1.js" defer></script>
  </body>
</html>
